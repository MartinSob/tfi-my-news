@using BusinessEntity;
@using MyNews.Models;
@model ListModel<BusinessEntity.BitacoreMessage>
@{
	int i = 1;
}

<div class="container.is-widescreen my-5">
	<div class="columns">
		<div class="column px-5">
			<h1 class="title is-2"><i class="fas fa-clipboard-list"></i> Bitacore</h1>

			<div class="filter-container">
				<div class="columns">
					<div class="column">
						<div class="field">
							<label class="label">Text</label>
							<div class="control">
								<input id="typeFilter" class="input" type="text">
							</div>
						</div>
					</div>
					<div class="column">
						<div class="field">
							<label class="label">From</label>
							<div class="control">
								<input id="fromFilter" class="input" type="date" placeholder="From">
							</div>
						</div>
					</div>
					<div class="column">
						<div class="field">
							<label class="label">To</label>
							<div class="control">
								<input id="toFilter" class="input" type="date" placeholder="To">
							</div>
						</div>
					</div>
				</div>

				<button id="filterBtn" class="button"><i class="fas fa-search"></i></button>
			</div>

			<table class="table is-striped is-hoverable" style="width: 100%">
				<thead>
					<tr>
						<th>#</th>
						<th>Title</th>
						<th>Description</th>
						<th>Type</th>
						<th>Date</th>
						<th>User</th>
					</tr>
				</thead>
				<tbody>
					@foreach (BitacoreMessage msg in Model.Items) {
						<tr id="@msg.id">
							<td>@(i++)</td>
							<td>@msg.title</td>
							<td>@msg.description</td>
							<td>@msg.type</td>
							<td>@msg.date.ToString()</td>
							<td>@(msg.user != null? msg.user.username : "") </td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>

	<script>
		let params = new URLSearchParams(location.search);
		document.getElementById("fromFilter").value = params.get('from')
		document.getElementById("toFilter").value = params.get('to')
		document.getElementById("typeFilter").value = params.get('type')
		
		document.getElementById("filterBtn").addEventListener("click", async (event) => {
			const from = document.getElementById("fromFilter").value;
			const to = document.getElementById("toFilter").value;
			const type = document.getElementById("typeFilter").value;
			window.location.replace('?from=' + from + '&to=' + to + '&type=' + type);
		});
	</script>
</div>
